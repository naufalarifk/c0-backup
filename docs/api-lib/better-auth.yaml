openapi: 3.1.1
info:
  title: Better Auth
  description: API Reference for your Better Auth Instance
  version: 1.1.0

servers:
  - url: http://localhost:27474/api/auth

security:
  - apiKeyCookie: []
    bearerAuth: []

components:
  # Reusable YAML anchors
  x-common-responses: &common-responses
    '400':
      $ref: '#/components/responses/BadRequest'
    '401':
      $ref: '#/components/responses/Unauthorized'
    '403':
      $ref: '#/components/responses/Forbidden'
    '404':
      $ref: '#/components/responses/NotFound'
    '429':
      $ref: '#/components/responses/TooManyRequests'
    '500':
      $ref: '#/components/responses/InternalServerError'

  securitySchemes:
    apiKeyCookie:
      type: apiKey
      in: cookie
      name: apiKeyCookie
      description: API Key authentication via cookie
    bearerAuth:
      type: http
      scheme: bearer
      description: Bearer token authentication

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
        emailVerified:
          type: boolean
          default: false
        image:
          type: string
        createdAt:
          type: string
          format: date-time
          default: Generated at runtime
        updatedAt:
          type: string
          format: date-time
          default: Generated at runtime
        twoFactorEnabled:
          type: boolean
          default: false
          readOnly: true
        phoneNumber:
          type: string
        phoneNumberVerified:
          type: boolean
          readOnly: true
        userType:
          type: string
          default: Undecided
        kycStatus:
          type: string
          default: none
        institutionUserId:
          type: string
          default: null
        institutionRole:
          type: string
          default: null
        businessName:
          type: string
          default: null
        businessType:
          type: string
          default: null
      required:
        - id
        - name
        - email
        - emailVerified
        - createdAt
        - updatedAt

    Session:
      type: object
      properties:
        id:
          type: string
        expiresAt:
          type: string
          format: date-time
        token:
          type: string
        createdAt:
          type: string
          format: date-time
          default: Generated at runtime
        updatedAt:
          type: string
          format: date-time
        ipAddress:
          type: string
        userAgent:
          type: string
        userId:
          type: string
      required:
        - id
        - expiresAt
        - token
        - createdAt
        - updatedAt
        - userId

    Account:
      type: object
      properties:
        id:
          type: string
        accountId:
          type: string
        providerId:
          type: string
        userId:
          type: string
        accessToken:
          type: string
        refreshToken:
          type: string
        idToken:
          type: string
        accessTokenExpiresAt:
          type: string
          format: date-time
        refreshTokenExpiresAt:
          type: string
          format: date-time
        scope:
          type: string
        password:
          type: string
        createdAt:
          type: string
          format: date-time
          default: Generated at runtime
        updatedAt:
          type: string
          format: date-time
      required:
        - accountId
        - providerId
        - userId
        - createdAt
        - updatedAt

    Verification:
      type: object
      properties:
        id:
          type: string
        identifier:
          type: string
        value:
          type: string
        expiresAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
          default: Generated at runtime
        updatedAt:
          type: string
          format: date-time
          default: Generated at runtime
      required:
        - identifier
        - value
        - expiresAt
        - createdAt
        - updatedAt

    TwoFactor:
      type: object
      properties:
        id:
          type: string
        secret:
          type: string
        backupCodes:
          type: string
        userId:
          type: string
      required:
        - secret
        - backupCodes
        - userId

    # Common request/response schemas
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
      required:
        - message

    StatusResponse:
      type: object
      properties:
        status:
          type: boolean
      required:
        - status

    SessionResponse:
      type: object
      properties:
        session:
          $ref: '#/components/schemas/Session'
        user:
          $ref: '#/components/schemas/User'
      required:
        - session
        - user

    AuthResponse:
      type: object
      properties:
        redirect:
          type: boolean
          enum: [false]
        token:
          type: string
          description: Session token
        url:
          type: "null"
          nullable: true
        user:
          $ref: '#/components/schemas/User'
      required:
        - redirect
        - token
        - user

    OAuthIdToken:
      type: object
      properties:
        token:
          type: string
          description: ID token from the provider
        nonce:
          type: string
          description: Nonce used to generate the token
          nullable: true
        accessToken:
          type: string
          description: Access token from the provider
          nullable: true
        refreshToken:
          type: string
          description: Refresh token from the provider
          nullable: true
        expiresAt:
          type: number
          description: Expiry date of the token
          nullable: true
      required:
        - token

    TokenResponse:
      type: object
      properties:
        tokenType:
          type: string
        idToken:
          type: string
        accessToken:
          type: string
        refreshToken:
          type: string
        accessTokenExpiresAt:
          type: string
          format: date-time
        refreshTokenExpiresAt:
          type: string
          format: date-time

    AccountInfo:
      type: object
      properties:
        id:
          type: string
        providerId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        accountId:
          type: string
        scopes:
          type: array
          items:
            type: string
      required:
        - id
        - providerId
        - createdAt
        - updatedAt
        - accountId
        - scopes

  requestBodies:
    EmailSignUp:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                description: The name of the user
              email:
                type: string
                description: The email of the user
              password:
                type: string
                description: The password of the user
              image:
                type: string
                description: The profile image URL of the user
              callbackURL:
                type: string
                description: The URL to use for email verification callback
              rememberMe:
                type: boolean
                description: If this is false, the session will not be remembered. Default is `true`.
            required:
              - name
              - email
              - password

    EmailSignIn:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              email:
                type: string
                description: Email of the user
              password:
                type: string
                description: Password of the user
              callbackURL:
                type: string
                description: Callback URL to use as a redirect for email verification
                nullable: true
              rememberMe:
                type: string
                nullable: true
            required:
              - email
              - password

    SocialSignIn:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              callbackURL:
                type: string
                description: Callback URL to redirect to after the user has signed in
                nullable: true
              newUserCallbackURL:
                type: string
                nullable: true
              errorCallbackURL:
                type: string
                description: Callback URL to redirect to if an error happens
                nullable: true
              provider:
                type: string
              disableRedirect:
                type: boolean
                description: Disable automatic redirection to the provider. Useful for handling the redirection yourself
                nullable: true
              idToken:
                $ref: '#/components/schemas/OAuthIdToken'
                nullable: true
              scopes:
                type: array
                description: Array of scopes to request from the provider. This will override the default scopes passed.
                nullable: true
              requestSignUp:
                type: boolean
                description: Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider
                nullable: true
              loginHint:
                type: string
                description: The login hint to use for the authorization code request
                nullable: true
            required:
              - provider

    PasswordRequest:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              password:
                type: string
                description: User password
            required:
              - password

    TwoFactorCode:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              code:
                type: string
                description: 'The otp code to verify. Eg: "012345"'
              trustDevice:
                type: boolean
                description: "If true, the device will be trusted for 30 days. It'll be refreshed on every sign in request within this time. Eg: true"
                nullable: true
            required:
              - code

    PhoneNumberOTP:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              phoneNumber:
                type: string
                description: 'Phone number. Eg: "+1234567890"'
              code:
                type: string
                description: 'OTP code. Eg: "123456"'
              disableSession:
                type: boolean
                description: "Disable session creation after verification. Eg: false"
                nullable: true
              updatePhoneNumber:
                type: boolean
                description: "Check if there is a session and update the phone number. Eg: true"
                nullable: true
            required:
              - phoneNumber
              - code

  responses:
    BadRequest:
      description: Bad Request. Usually due to missing parameters, or invalid parameters.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Unauthorized:
      description: Unauthorized. Due to missing or invalid authentication.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    Forbidden:
      description: Forbidden. You do not have permission to access this resource or to perform this action.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFound:
      description: Not Found. The requested resource was not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    TooManyRequests:
      description: Too Many Requests. You have exceeded the rate limit. Try again later.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalServerError:
      description: Internal Server Error. This is a problem with the server that you cannot fix.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    UnprocessableEntity:
      description: Unprocessable Entity. User already exists or failed to create user.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: Default
    description: Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin.
  - name: Two-factor
    description: Two-factor authentication endpoints
  - name: Phone-number
    description: Phone number authentication endpoints
  - name: Multi-session
    description: Multi-session management endpoints

paths:
  /sign-in/social:
    post:
      tags: [Default]
      description: Sign in with a social provider
      operationId: socialSignIn
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/SocialSignIn'
      responses:
        '200':
          description: Success - Returns either session details or redirect URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        <<: *common-responses

  /get-session:
    get:
      tags: [Default]
      description: Get the current session
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
        <<: *common-responses

  /sign-out:
    post:
      tags: [Default]
      description: Sign out the current user
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        <<: *common-responses

  /sign-up/email:
    post:
      tags: [Default]
      description: Sign up a user using email and password
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/EmailSignUp'
      responses:
        '200':
          description: Successfully created user
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    nullable: true
                    description: Authentication token for the session
                  user:
                    $ref: '#/components/schemas/User'
                required:
                  - user
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        <<: *common-responses

  /sign-in/email:
    post:
      tags: [Default]
      description: Sign in with email and password
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/EmailSignIn'
      responses:
        '200':
          description: Success - Returns either session details or redirect URL
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        <<: *common-responses

  /forget-password:
    post:
      tags: [Default]
      description: Send a password reset email to the user
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: The email address of the user to send a password reset email to
                redirectTo:
                  type: string
                  description: The URL to redirect the user to reset their password
                  nullable: true
              required:
                - email
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  message:
                    type: string
        <<: *common-responses

  /reset-password:
    post:
      tags: [Default]
      description: Reset the password for a user
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newPassword:
                  type: string
                  description: The new password to set
                token:
                  type: string
                  description: The token to reset the password
                  nullable: true
              required:
                - newPassword
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /verify-email:
    get:
      tags: [Default]
      description: Verify the email of the user
      security: [{bearerAuth: []}]
      parameters:
        - name: token
          in: query
          description: The token to verify the email
          required: true
          schema:
            type: string
        - name: callbackURL
          in: query
          description: The URL to redirect to after email verification
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  status:
                    type: boolean
                    description: Indicates if the email was verified successfully
                required:
                  - user
                  - status
        <<: *common-responses

  /send-verification-email:
    post:
      tags: [Default]
      description: Send a verification email to the user
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: The email to send the verification email to
                  example: user@example.com
                callbackURL:
                  type: string
                  description: The URL to use for email verification callback
                  example: https://example.com/callback
                  nullable: true
              required:
                - email
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /change-email:
    post:
      tags: [Default]
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newEmail:
                  type: string
                  description: The new email address to set must be a valid email address
                callbackURL:
                  type: string
                  description: The URL to redirect to after email verification
                  nullable: true
              required:
                - newEmail
      responses:
        '200':
          description: Email change request processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    description: Indicates if the request was successful
                  message:
                    type: string
                    enum:
                      - Email updated
                      - Verification email sent
                    description: Status message of the email change process
                    nullable: true
                required:
                  - status
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        <<: *common-responses

  /change-password:
    post:
      tags: [Default]
      description: Change the password of the user
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                newPassword:
                  type: string
                  description: The new password to set
                currentPassword:
                  type: string
                  description: The current password is required
                revokeOtherSessions:
                  type: boolean
                  description: Must be a boolean value
                  nullable: true
              required:
                - newPassword
                - currentPassword
      responses:
        '200':
          description: Password successfully changed
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    nullable: true
                    description: New session token if other sessions were revoked
                  user:
                    $ref: '#/components/schemas/User'
                required:
                  - user
        <<: *common-responses

  /update-user:
    post:
      tags: [Default]
      description: Update the current user
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: The name of the user
                image:
                  type: string
                  description: The image of the user
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /delete-user:
    post:
      tags: [Default]
      description: Delete the user
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                callbackURL:
                  type: string
                  description: The callback URL to redirect to after the user is deleted
                  nullable: true
                password:
                  type: string
                  description: The password of the user is required to delete the user
                  nullable: true
                token:
                  type: string
                  description: The token to delete the user is required
                  nullable: true
      responses:
        '200':
          description: User deletion processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indicates if the operation was successful
                  message:
                    type: string
                    enum:
                      - User deleted
                      - Verification email sent
                    description: Status message of the deletion process
                required:
                  - success
                  - message
        <<: *common-responses

  /list-sessions:
    get:
      tags: [Default]
      description: List all active sessions for the user
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Session'
        <<: *common-responses

  /revoke-session:
    post:
      tags: [Default]
      description: Revoke a single session
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
                  description: The token to revoke
              required:
                - token
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /revoke-sessions:
    post:
      tags: [Default]
      description: Revoke all sessions for the user
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /revoke-other-sessions:
    post:
      tags: [Default]
      description: Revoke all other sessions for the user except the current one
      security: [{bearerAuth: []}]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /link-social:
    post:
      tags: [Default]
      description: Link a social account to the user
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/SocialSignIn'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    description: The authorization URL to redirect the user to
                  redirect:
                    type: boolean
                    description: Indicates if the user should be redirected to the authorization URL
                  status:
                    type: boolean
                required:
                  - redirect
        <<: *common-responses

  /list-accounts:
    get:
      tags: [Default]
      description: List all accounts linked to the user
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AccountInfo'
        <<: *common-responses

  /unlink-account:
    post:
      tags: [Default]
      description: Unlink an account
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                providerId:
                  type: string
                accountId:
                  type: string
                  nullable: true
              required:
                - providerId
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /refresh-token:
    post:
      tags: [Default]
      description: Refresh the access token using a refresh token
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                providerId:
                  type: string
                  description: The provider ID for the OAuth provider
                accountId:
                  type: string
                  description: The account ID associated with the refresh token
                  nullable: true
                userId:
                  type: string
                  description: The user ID associated with the account
                  nullable: true
              required:
                - providerId
      responses:
        '200':
          description: Access token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        <<: *common-responses

  /get-access-token:
    post:
      tags: [Default]
      description: Get a valid access token, doing a refresh if needed
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                providerId:
                  type: string
                  description: The provider ID for the OAuth provider
                accountId:
                  type: string
                  description: The account ID associated with the refresh token
                  nullable: true
                userId:
                  type: string
                  description: The user ID associated with the account
                  nullable: true
              required:
                - providerId
      responses:
        '200':
          description: A Valid access token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        <<: *common-responses

  /account-info:
    post:
      tags: [Default]
      description: Get the account info provided by the provider
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                accountId:
                  type: string
                  description: The provider given account id for which to get the account info
              required:
                - accountId
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  data:
                    type: object
                    additionalProperties: true
                required:
                  - user
                  - data
        <<: *common-responses

  /ok:
    get:
      tags: [Default]
      description: Check if the API is working
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: API is working
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    description: Indicates if the API is working
                required:
                  - ok
        <<: *common-responses

  /error:
    get:
      tags: [Default]
      description: Displays an error page
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: Success
          content:
            text/html:
              schema:
                type: string
                description: The HTML content of the error page
        <<: *common-responses

  # Two-factor endpoints
  /two-factor/get-totp-uri:
    post:
      tags: [Two-factor]
      description: Use this endpoint to get the TOTP URI
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/PasswordRequest'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  totpURI:
                    type: string
        <<: *common-responses

  /two-factor/verify-totp:
    post:
      tags: [Two-factor]
      description: Verify two factor TOTP
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/TwoFactorCode'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /two-factor/send-otp:
    post:
      tags: [Two-factor]
      description: Send two factor OTP to the user
      security: [{bearerAuth: []}]
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /two-factor/verify-otp:
    post:
      tags: [Two-factor]
      description: Verify two factor OTP
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/TwoFactorCode'
      responses:
        '200':
          description: Two-factor OTP verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: Session token for the authenticated session
                  user:
                    $ref: '#/components/schemas/User'
                required:
                  - token
                  - user
        <<: *common-responses

  /two-factor/verify-backup-code:
    post:
      tags: [Two-factor]
      description: Verify a backup code for two-factor authentication
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: 'A backup code to verify. Eg: "123456"'
                disableSession:
                  type: boolean
                  description: If true, the session cookie will not be set.
                  nullable: true
                trustDevice:
                  type: boolean
                  description: "If true, the device will be trusted for 30 days."
                  nullable: true
              required:
                - code
      responses:
        '200':
          description: Backup code verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  session:
                    $ref: '#/components/schemas/Session'
                required:
                  - user
                  - session
        <<: *common-responses

  /two-factor/generate-backup-codes:
    post:
      tags: [Two-factor]
      description: Generate new backup codes for two-factor authentication
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/PasswordRequest'
      responses:
        '200':
          description: Backup codes generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    description: Indicates if the backup codes were generated successfully
                    enum: [true]
                  backupCodes:
                    type: array
                    items:
                      type: string
                    description: Array of generated backup codes in plain text
                required:
                  - status
                  - backupCodes
        <<: *common-responses

  /two-factor/enable:
    post:
      tags: [Two-factor]
      description: Use this endpoint to enable two factor authentication
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                password:
                  type: string
                  description: User password
                issuer:
                  type: string
                  description: Custom issuer for the TOTP URI
                  nullable: true
              required:
                - password
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  totpURI:
                    type: string
                    description: TOTP URI
                  backupCodes:
                    type: array
                    items:
                      type: string
                    description: Backup codes
        <<: *common-responses

  /two-factor/disable:
    post:
      tags: [Two-factor]
      description: Use this endpoint to disable two factor authentication
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/PasswordRequest'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  # Phone number endpoints
  /sign-in/phone-number:
    post:
      tags: [Phone-number]
      description: Use this endpoint to sign in with phone number
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phoneNumber:
                  type: string
                  description: 'Phone number to sign in. Eg: "+1234567890"'
                password:
                  type: string
                  description: Password to use for sign in
                rememberMe:
                  type: boolean
                  description: "Remember the session. Eg: true"
                  nullable: true
              required:
                - phoneNumber
                - password
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionResponse'
        <<: *common-responses

  /phone-number/send-otp:
    post:
      tags: [Phone-number]
      description: Use this endpoint to send OTP to phone number
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phoneNumber:
                  type: string
                  description: 'Phone number to send OTP. Eg: "+1234567890"'
              required:
                - phoneNumber
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        <<: *common-responses

  /phone-number/verify:
    post:
      tags: [Phone-number]
      description: Use this endpoint to verify phone number
      security: [{bearerAuth: []}]
      requestBody:
        $ref: '#/components/requestBodies/PhoneNumberOTP'
      responses:
        '200':
          description: Phone number verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    description: Indicates if the verification was successful
                    enum: [true]
                  token:
                    type: string
                    nullable: true
                    description: Session token if session is created
                  user:
                    $ref: '#/components/schemas/User'
                    nullable: true
                    description: User object with phone number details
                required:
                  - status
        <<: *common-responses

  /phone-number/forget-password:
    post:
      tags: [Phone-number]
      description: Request OTP for password reset via phone number
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phoneNumber:
                  type: string
                  description: 'The phone number which is associated with the user. Eg: "+1234567890"'
              required:
                - phoneNumber
      responses:
        '200':
          description: OTP sent successfully for password reset
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /phone-number/request-password-reset:
    post:
      tags: [Phone-number]
      description: Request OTP for password reset via phone number
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                phoneNumber:
                  type: string
              required:
                - phoneNumber
      responses:
        '200':
          description: OTP sent successfully for password reset
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  /phone-number/reset-password:
    post:
      tags: [Phone-number]
      description: Reset password using phone number OTP
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                otp:
                  type: string
                  description: 'The one time password to reset the password. Eg: "123456"'
                phoneNumber:
                  type: string
                  description: 'The phone number to the account. Eg: "+1234567890"'
                newPassword:
                  type: string
                  description: 'The new password. Eg: "new-and-secure-password"'
              required:
                - otp
                - phoneNumber
                - newPassword
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  # Multi-session endpoints  
  /multi-session/list-device-sessions:
    get:
      tags: [Multi-session]
      security: [{bearerAuth: []}]
      responses:
        <<: *common-responses

  /multi-session/set-active:
    post:
      tags: [Multi-session]
      description: Set the active session
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionToken:
                  type: string
                  description: The session token to set as active
              required:
                - sessionToken
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  session:
                    $ref: '#/components/schemas/Session'
        <<: *common-responses

  /multi-session/revoke:
    post:
      tags: [Multi-session]
      description: Revoke a device session
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sessionToken:
                  type: string
                  description: The session token to revoke
              required:
                - sessionToken
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        <<: *common-responses

  # Legacy endpoints
  /reset-password/{token}:
    get:
      tags: [Default]
      description: Redirects the user to the callback URL with the token
      security: [{bearerAuth: []}]
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
        - name: callbackURL
          in: query
          schema:
            type: string
            description: The URL to redirect the user to reset their password
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
        <<: *common-responses

  /request-password-reset:
    post:
      tags: [Default]
      description: Send a password reset email to the user
      security: [{bearerAuth: []}]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  description: The email address of the user to send a password reset email to
                redirectTo:
                  type: string
                  description: The URL to redirect the user to reset their password
                  nullable: true
              required:
                - email
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                  message:
                    type: string
        <<: *common-responses

  /delete-user/callback:
    get:
      tags: [Default]
      description: Callback to complete user deletion with verification token
      security: [{bearerAuth: []}]
      parameters:
        - name: token
          in: query
          schema:
            type: string
            description: The token to verify the deletion request
        - name: callbackURL
          in: query
          schema:
            type: string
            description: The URL to redirect to after deletion
            nullable: true
      responses:
        '200':
          description: User successfully deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Indicates if the deletion was successful
                  message:
                    type: string
                    enum: [User deleted]
                    description: Confirmation message
                required:
                  - success
                  - message
        <<: *common-responses